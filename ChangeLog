2002-03-26  Alexander Dupuy  <dupuy@sysdetect.com>

	* test/Makefile (BK_SIMPLE_INTERNALPROGS): support "make test_fun"

	* test/test_config.c (main): bk_general_debug_config obviates
	bk_debug_setconfig

	* test/test_getbyfoo.c (main): bk_general_debug_config obviates
	bk_debug_setconfig

	* test/test_time.c (main): use BK_RETURN to keep Insure happy

	* test/test_bio.c, test/test_config.c, test/test_errorstuff.c:
	* test/test_fun.c, test/test_getbyfoo.c, test/test_ioh.c:
	* test/test_locks.c, test/test_stringconv.c, test/test_time.c:
	* test/test_url.c, test/testhashspeed.c:
	* test/testrandidea.c: use LOG_USER, not BK_ERR or LOG_LOCAL0
	
2002-03-19  James Tanis  <jtt@saint.sysdetect.com>

	* include/libbk.h (BK_USECTONSEC): Convert usecs <=> nsecs.

2002-03-19  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_oscompat.h (_PATH_DEVNULL): if not defined in unistd.h
	(BK_RHS): force compile error when using ?: or , expression as lvalue

2002-03-19  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_listnum.c: List of linked list heads.  Data structures for
	fixed expiry queues with large numbers of members that get deleted
	and reinserted a lot.

2002-03-18  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_exec.c (bk_pipe_to_exec): Toss stderr if user requests.

2002-03-18  Alexander Dupuy  <dupuy@sysdetect.com>

	* test/Makefile (BK_SIMPLE_INTERNALPROGS): build test_fun with
	funky path to test path stripping

	* test/test_fun.c: simple tests for bk_fun

2002-03-14  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_exec.c (bk_exec): use execvp where possible
	(bk_search_path): the most broken code I have seen in a long time
	- it didn't even come close to working [but was surely faster to write
	than something using g_spawn_async_with_pipes :-]

	* lib/b_url.c (bk_url_unescape): define in terms of bk_url_unescape_len
	(bk_url_unescape_len): this is the more fundamental variant
	(bk_url_getparam): allow alternate delimiters, case-independent tokens,
	whitespace in parameters

2002-03-14  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_url.c (bk_url_unescape_len): Same as bk_url_unescape(),
	but constrained to the given len.

2002-03-11  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_string.c (bk_string_printbuf): Don't write beyond end of str.

2002-03-07  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_pollio.c (bk_polling_io_do_poll): don't block if at EOF

	* lib/b_ioh.c (ioht_vector_other): document one of probably many
	bugs in vectored i/o
	(ioh_runhandler): avoid recursive close when destroying

2002-03-06  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (BK_FLAG_SET, BK_FLAG_CLEAR): make these statement
	macros to prevent inadvertent use in tests where BK_FLAG_IS* is meant
	(BK_URL_SCHEME_EQ, BK_URL_AUTHORITY_EQ): use STR{N,}EQ as appropriate
	(BK_STREQCASE, BK_STRNEQCASE): use str{n,}casecmp
	(BK_URL_SCHEME_EQ, BK_URL_AUTHORITY_EQ, BK_URL_PATH_EQ): use correct
	str{n,}{case,}cmp variant
	
2002-03-05  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (CONVERT_SUBSECSNTP2TIMEVAL): for completeness
	(CONVERT_SUBSECSNTP2TIMESPEC): use argument to macro, not "secs"
	(CONVERT_SUBSECSTIMESPEC2NTP): renamed, use 1LL for left shift

	* lib/b_time.c (bk_time_iso_format): use correct MICROSEC for
	proper determination of desired precision
	(bk_time_ntp_format): generate ntp stamps, too
	(bk_time_ntp_parse): simplify, eliminate malloc, use strtoul, not baka

	* lib/b_string.c (bk_decode_base64): don't NUL terminate vptr buf

	* test/entropy/randtest.c (log2): don't define function if macro exists

2002-03-05  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_listen): Add
	SO_REUSEADDR to listening socket.

2002-03-04  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_string.c (bk_decode_base64): Don't demand that base64 encoded
	buffer to be string.

2002-03-01  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_oscompat.h (BK_INIT_FUN, BK_FINISH_FUN) [__INSURE__]:
	use asm() to set up ctors/dtors since that doesn't offend insure++
	
2002-02-27  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_time.c (bk_time_ntp_parse): Parse ntp time into struct
	timespec [format function still needed].

2002-02-25  James Tanis  <jtt@saint.sysdetect.com>

	* src/proto.c (main): Clarify the arc preprocessing.

2002-02-22  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_connect): remove dead code
	(tcp_end): remove dead code

	* lib/b_pollio.c (polling_io_ioh_handler): suppress Insure error

	* include/libbk.h (BK_STRINGIFY): expand argument into string form

	* include/libbk_oscompat.h (BK_FUNCNAME): portable use of __func__
	(ntohll, htonll): cast everything to u_int64_t before 32 bit shifts
	suppress Insure error
	
2002-02-20  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h: declare bk_ioh_print{,f}

2002-02-20  Brian Lindauer  <lindauer@sysdetect.com>

	* lib/b_ioh.c: Added b_ioh_print and b_ioh_printf

2002-02-19  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_ioh.c (bk_ioh_fdctl): fcntl F_SETFL takes value, not pointer

2002-02-18  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_relay.c (bk_relay_iohhandler): update to use new coalesce interface.

	* lib/b_ioh.c (bk_ioh_coalesce): New flags to force (on input)
	copies and (on output) to indicate whether a copy had not
	happened. 
	(bk_ioh_coalesce): Do *not* free input vptr (violation of IOH API).

2002-02-11  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (BK_OR): improve doxygenation

	* include/libbk_oscompat.h: undef _CONSTRUCTOR_ATTRIBUTE,_INIT_PRAGMA
	for Insure++ compilation
	
2002-02-11  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_string.c (bk_string_intcols): DOH Some real dumb errors.

2002-02-11  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_string.c (bk_string_intcols): fix bugs, spelling errors,
	restrict bases

2002-02-07  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_exec.c (bk_pipe_to_process): possible decriptor leak repair

	* lib/b_string.c (bk_string_intcols): Count columns required for int

2002-01-31  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/Makefile (BK_LARGE_LIB): use ${LIBEXT} for libtool build

2002-01-30  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_oscompat.h (ntohll, htonll): 64-bit host/network order

2002-01-24  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_include.h: control some inclusions from autoconf

	* include/libbk_oscompat.h: autoconf control for sockaddr sa_len
	(BK_INIT_FUN): macro for load-time init
	(AF_LOCAL): define if missing but AF_UNIX exists

	* lib/b_netutils.c (bk_netutils_get_sa_len): use autoconf control

	* lib/b_time.c (bk_time_iso_parse): avoid mktime if it has bugs

2002-01-20  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_skid.c: Initial SKID implementation, or at least the
	*start* of the implementation.

	* lib/b_ioh.c (bk_ioh_coalesce): New coalescion code to centralize
	common activities with ioh buffers.

	* lib/b_relay.c (bk_relay_iohhandler): Use new ioh coalescion code

2002-01-19  James Tanis  <jtt@winwood.sysdetect.com>

	* include/libbk_oscompat.h (realloc): Redefine realloc to
	specifically use malloc when ptr is NULL (mostly for Insight,
	though protects against *really* broken malloc libs).

2002-01-19  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_ioh.c (bk_ioh_update): Duh, forgot to actually allow
	iofunopaque to be updated

	* src/genrand.c: Random number production program.  Suitable for
	password generation!

	* lib/b_md5.c: MD5 hash algorithm
	* lib/b_rand.c: Random number generation

	* test/testhashspeed.c: Hashing tests
	* test/testrandidea.c: Update with results

2002-01-19  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h: declare bk_time_iso_{parse,format}, bk_timegm

	* lib/b_time.c: implement iso 8601 date/time format & parse, timegm

	* lib/Makefile (BK_LARGE_LIBSRC): add b_time.c

2002-01-17  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_pollio.c (polling_io_ioh_handler): Patch up a memory leak
	caught by insight.

2002-01-16  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h: declare bk_url_getparam

	* lib/b_url.c (bk_url_getparam): parse semicolon-delimited parameters

2002-01-15  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_exec.c: Routines in support of executing processes.

2002-01-14  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_pollio.c (bk_polling_io_do_poll): Only set the don't block
	if there's data already sitting in queue.

2002-01-14  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_run.c (bk_run_getpref): Proper argument checking.
	(bk_run_setpref): Proper argument checking.

	* lib/b_ioh.c (ioh_runhandler): Setpre on correct fd.

2002-01-11  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (bk_iohh_bnbio_tell): use int64_t, not BSD quad_t

	* include/libbk_internal.h (struct bk_polling_io): use int64_t

	* lib/b_bnbio.c (bk_iohh_bnbio_tell): return int64_t

	* include/libbk_include.h (struct ether_addr): defined if none of the
	possible include files are present

	* include/libbk_oscompat.h: use BK_MINGW
	(HAVE_INET6): #ifdef AF_INET6 and HAVE_inet_pton

	* lib/b_getbyfoo.c (bk_gethostbyfoo, copy_hostent): #ifdef HAVE_INET6

	* lib/b_netaddr.c (bk_netaddr_addrdup, update_bna_pretty): HAVE_INET6
	(bk_netaddr_af2nat, bk_netaddr_nat2af): AF_INET6

	* test/test_getbyfoo.c (host_callback): #ifdef HAVE_INET6

	* lib/b_signal.c (bk_signal_set, bk_signal_set_alarm, bk_signal_reset):
	(bk_signal_reset_alarm): use sigprocmask, not BSD sigblock/sigsetmask

2002-01-09  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (BK_ENV_GWD): use BK_OR()
	(BK_VERSION_CMP): use BK_OR
	(BK_TV_CMP): use BK_OR

	* test/test_url.c (PRINT_ELEMENT): test bk_url_unescape

	* lib/b_url.c (bk_url_unescape): new function to expand % escapes
	(bk_url_parse): separate strict parse flag for function from flags
	in structure
	(count_colons): eliminated this obsolete static function
	
	* lib/b_general.c (bk_general_proctitle_init): don't confuse flag
	for function with flag in structure; always turn off proctitle
	stuff when running with Insure++

	* lib/b_debug.c (bk_debug_destroy): free bk_debug struct itself

	* include/libbk.h (BK_OR): wrap GNU extension to ?: omitting middle arg

	* include/libbk_i18n.h: INSIGHT->INSURE, include <locale.h>

	* include/libbk_include.h (u_int#_t): work around esoteric gcc'isms
	that Insure++ doesn't grok at all

2002-01-08  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_string.c (bk_string_str2xml): Function to convert a normal
	string to an xml string.

2002-01-02  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_nvmap.c (bk_nvmap_value2name): Functions to map strings to values.

2001-12-31  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_pollio.c (bk_polling_io_data_destroy): make sure that ptr
	exists before freeing.

2001-12-27  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_include.h: <netinet/if_ether.h> if no <net/ethernet.h>

2001-12-27  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_url.c (bk_url_parse): missed a few critical search
	stopping characters in the fuzzy logic code. 

2001-12-27  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/Makefile ($(GROUPTOP)/include/libbk_autoconf.h): create link
	to bkmk-generated file

	* include/libbk_include.h: use BK_MINGW, autoconf HAVE_ defines

	* include/libbk.h: include libbk_autoconf.h

	* include/Makefile (BK_PUBLIC_INC): install libbk_autoconf.h

2001-12-21  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_string.c: constifying

2001-12-21  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_url.c: Brand new rfc2396 compliant url parsing code.
	(bk_url_parse): Free up apparently unset data because it is not in
	fact unset :-)

2001-12-20  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_fileutils.c: Many many lock related changes. Locks now
	working. Interface change to allow the discriminatin between "lock
	held" failure and general failure. Admin file removed when empty.

2001-12-19  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_run.c (bk_run_on_demand_add): Set brof key (DOH!)
	(bk_run_on_demand_remove): Actutally destroy brof you are removing.

	* lib/b_pollio.c (bk_polling_io_create): Sigh. Fully initialize
	structure (despite memset()) in order to pacify insight.
	(bk_polling_io_close): Lingering close.
	(bk_polling_io_close): Close out ioh too.
	(polling_io_ioh_handler): Don't destroy bpi if asked not too
	(lingering close).
	(bk_polling_io_data_destroy): We only need to destroy one vptr.

	* lib/b_ioh.c (ioh_execute_cmds): Make sure you clear and destroy
	the dll regardless of content of nodes.

	* lib/b_bnbio.c (bk_iohh_bnbio_close): Lingering close.

2001-12-14  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_ioh.c: Convert messages to use structures and dll's
	instead of an OR'ed integer.

2001-12-13  James Tanis  <jtt@saint.sysdetect.com>

	* include/libbk.h (enum): BkIohStatusIohAbort removed owing to non-use.

2001-12-12  James Tanis  <jtt@saint.sysdetect.com>

	* include/libbk.h (bk_ioh_status_e): Convert ioh handler status to
	an enum and update everybody who uses it.

	* lib/b_ioh.c: Rename bk_iohhandler, bk_iohhandler_f to bring it
	line with standards docs.

	* lib/b_run.c (bk_run_once): Support for aborting bk_run_once if
	another bk_run_once() has exited on the "thread" this bk_run_once
	has just processed.

2001-12-11  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_ioh.c (bk_ioh_destroy): make this static.

	* src/bttcp.c (connect_complete): noone other than ioh.c should
	use bk_ioh_destroy.

	* lib/b_url.c (bk_url_parse): Fix bk_strndup() usage to account
	for its better behavior.
	(bk_url_parse): Allow caller to pass in flag which makes bare path
	component return a protocol of "file".

	* lib/b_string.c (bk_strndup): Allocate extra space for NULL.

	* lib/b_signal.c (bk_signal_mgmt): Allow users to manage signal
	handlers. 
	(bk_signal_set_alarm): Function to safely seize control of a signal.
	(bk_signal_reset_alarm): Function to safely reset the above.
	(bk_signal_set): Function to safely seize control of any signal.
	(bk_signal_reset): Fuction to safely reset the above.

	* lib/b_string.c: Eliminatef bk_strdelim which is identical to
	strpbrk (thanks to Alex for pointing this out).

	* lib/b_url.c (bk_url_parse): Correct for ipv6.

2001-12-10  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_string.c (bk_strdelim): new function to return first
	position in s *not* in string s1.
	(bk_strndup): Like strdup but only do n chars.

	* lib/b_url.c: File for url munging.
	(bk_url_parse): Seth's alg. (at least mostly done).

	* include/libbk.h (struct bk_version): bk_version stuff added.

2001-12-06  James Tanis  <jtt@winwood.sysdetect.com>

	* libbk: many other dumb insight related cleanup.

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_listen): Prevent
	memory leack in accept state.

2001-12-05  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_memx.c (bk_memx_get): Return current used, not current allocated

	* lib/b_general.c (bk_general_init): Insight does some really stupid things.

2001-12-05  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_config.c: Make sure that bc is checked after SET_CONFIG

2001-12-04  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_netutils.c (bk_netutils_start_service_verbose): Null out
	the appropriate things at the appropriate time to avoid double free.

	* libbk: (everwhere) Replace XXX's with standards document
	compliant notation

	* include/libbk.h: Camel case and _e all enums (propogate through
	source files too).
	Change callback_t's to callback_f's (propogate).

2001-11-30  Seth Robertson  <seth@startide.sysdetect.com>

	* README.i18n: Internationalization hints
	* src/proto.c: Internationalized
	* include/libbk_i18n.h: Starting formal internalization support

2001-12-04  James Tanis  <jtt@winwood.sysdetect.com>

	* src/bttcp.c (connect_complete): Check for bag's existence as per
	the API

	* lib/b_netinfo.c (bk_netinfo_from_socket): make sure len is
	initialized (jtt must have dropped this somewhere today).

	* src/bttcp.c (proginit): Patch up old service staring names to
	new. 

	* lib/b_netutils.c (bk_parse_endpt_no_defaults): Convenience
	function for parsing a url with no default values (as in a default
	url).
	(bk_netutils_start_service): Short version of start_servce (old
	version renamed to BLAH_verbose).
	(bk_netutils_make_conn): Short version of make_conn (old version
	renmaed to BLAH_verbose).

	* lib/b_addrgroup.c (net_init_end): Don't bypass callback on error
	(DOH!).

	* src/bttcp.c: Convert to using new event granularity (ie: fix
	timeouts).

2001-12-03  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_netutils.c: Convert to new bk_addrgroup_state_e values.
	(bk_netutils_make_conn): Make sure that values handed over to sss
	are not freed. Make sure that sss is not freed once callback has
	been called (it was freed in the callback).
	(bk_netutils_make_conn): make sure that all temporary values are
	freed. 

	* lib/b_netinfo.c (bk_netinfo_advance_primary_address): Function
	to iterate thru address list, setting each to primary in turn.

	* lib/b_addrgroup.c: Converted state info over to new mode.
	(tcp_connect_start): Use advence_primary_address() interface
	(bk_net_init_sys_error): Convert errno's to error state.

	* lib/b_run.c: Debugging code
	(bk_run_close): Check fdassoc_delete return code.

	* lib/b_ioh.c (bk_ioh_update): Fix sanity checking for new API.

	* lib/b_addrgroup.c (net_init_end): Move bag allocation
	here. Allocate/free everytime.
	(tcp_connect_activity): Check gottype flags.
	(tcp_listen_activity): Check gottype flags.
	(net_init_end): Alter interface since bag allocation done here.

	* lib/b_servinfo.c (bk_servinfo_serventdup): Host/network order SNAFU.
	(bk_servinfo_serventdup): protocol info no longer required.

	* lib/b_getbyfoo.c (bk_getservbyfoo): Host/network order SNAFU.

2001-11-30  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_servinfo.c: protostr nuked from servinfo.

	* lib/b_netutils.c (bk_netutils_start_service): Conform to new
	interface. 
	(sss_serv_gethost_complete): Best effort callback.
	(bk_netutils_make_conn): Get proto and serv info in one shot
	(bk_netutils_make_conn): Best effort callback.

	* lib/b_getbyfoo.c (bk_getprotobyfoo): ip ==> iproto
	(bk_getprotofoo): Force lookup if copyout is set
	(bk_getservbyfoo): protostr now out of bk_servinfo.
	(bk_getservbyfoo): Assume "tcp" if protocol can't be determined.
	(bk_getservbyfoo): Force lookup if copyout is set
	(bk_gethostbyfoo): No copy out.
	(bk_gethostbyfoo): Make callback on errors if at all possible.
	(bk_gethostbyfoo_abort): Renamed to better name.

2001-11-29  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_relay.c lib/b_ioh.c: Code review day 4

2001-11-28  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_memx.c lib/b_run.c lib/b_string.c lib/b_ioh.c: Code review day 3

2001-11-27  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_addrgroup.c lib/b_getbyfoo.c lib/b_netaddr.c
	lib/b_netinfo.c lib/b_netutils.c lib/b_protoinfo.c
	lib/b_servinfo.c lib/b_run.c lib/b_stdfun.c: Code review day 2

2001-11-28  James Tanis  <jtt@winwood.sysdetect.com>

	* test/test_getbyfoo.c (progrun): Fix up to conform to new API.

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_listen): Don't free
	bag.

2001-11-27  James Tanis  <jtt@winwood.sysdetect.com>

	* src/bttcp.c: Eliminate useless function.

2001-11-26  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_bits.c lib/b_general.c lib/b_config.c lib/b_debug.c
	lib/b_error.c lib/b_fileutils.c lib/b_fun.c lib/b_funlist.c:
	Day one, code review.

2001-11-26  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_fileutils.c (bk_fileutils_modify_fd_flags): Added SET
	option as per Seth's suggestion.

2001-11-21  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_addrgroup.c (bk_addrgroup_get_server_socket): Get the
	server socket from the handle.
	(bk_addrgroup_server_close): Close up the server based referenced
	by the handle.
	(as_server_copy): Copy an as from the server as to the connected as.
	Adjust everybody to send server_handle on callback.
	(tcp_listen_activity): Make sure you change the state of the *new*
	as not the old.
	Convert everybody to store complete state in as.

2001-11-20  James Tanis  <jtt@winwood.sysdetect.com>

	* src/bttcp.c: Converted to use new convenient interface. State
	code removed.

	* lib/b_netutils.c (bk_netutils_make_conn): Make a connection with
	a convenient interface.
	(sss_connect_rgethost_complete): Call back when we've completed
	looking up the remote host.
	(sss_connect_lgethost_complete): Callback when we've completed
	looking up the local host.

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_listen): Call back on
	server ready.
	Convert everybody to use state.
	(bk_netutils_commandeer_service): Take over an existing server socket.
	Convert back to as->as_bag as pointer.
	(as_destroy): Destroy as completely.
	(net_init_check_sanity): Make sure you don't reference a pointer
	after you've verified that it DOESN'T EXIST!! sheesh...

2001-11-20  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_config.c (bk_config_get): Provide method to access config
	configuration parameters.

2001-11-20  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_addrgroup.c (tcp_end): Flag to request BAG on connection
	completion, otherwise we clean it up.

	* src/bttcp.c: Convert to use new service start interface.

	* lib/b_netutils.c (bk_parse_endpt_spec): Parses BK "URL".
	(bk_netutils_start_service): Start up a service with very user
	friendly arguments.
	(sss_gethost_complete): Where to go when hostname search complets
	in above function.

2001-11-19  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_run.c (bk_run_destroy): remember to destroy event queue.

	* lib/b_addrgroup.c (bag_destroy): Remeber to destroy bni's
	internal to bag.

	* lib/b_getbyfoo.c (bk_getprotobyfoo): Clean up allocated protoent
	if not saved.
	(bk_getservbyfoo): Clean up allocated servent if not saved.

2001-11-18  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_string.c (bk_encode_base64): Correct pointer bugaboo.
	Mime now working.

	* src/bttcp.c: Update James' documentation and formatting.  Shame on James.

	* lib/b_string.c (bk_encode_base64): Mime encode/decode routines

	* src/mmcat.c (main): Mime encode/decode test program (useful too)

2001-11-16  James Tanis  <jtt@winwood.sysdetect.com>

	* src/bttcp.c (main): If using -r without -l make the local name
	BK_ADDR_ANY.
	(proginit): Don't create remote bk_netinfo if we're receiving.
	Listening transfers now working.

	* lib/b_getbyfoo.c (bk_gethostbyfoo): support for "resolving" the
	special token BK_ADDR_ANY ("resolves" to the ANY address for the
	given address family).

	* lib/b_addrgroup.c (do_net_init_af_inet_tcp_listen): Some copy
	paste errors copied from connect section.
	(net_init_check_sanity): Correct sanity checking. Was doing
	*everything* under if (remote && local) condition which was
	patently wrong

	* test/test_getbyfoo.c (main): Better usage message.

	* src/proto.c (main): Example of how to configure pOpt to print
	out the meaning of an option argument on the usage (brief) line.

	* src/bttcp.c: Too many chages. *Connecting* relay works.

	* lib/b_netinfo.c (bk_netinfo_from_socket): Initialize inet
	sockaddr's correctly.
	(bk_netinfo_from_socket): Don't pass sockaddr when you mean to
	pass only the contained address.
	(bk_netinfo_from_socket): Split out INET6 (sigh). There are *just*
	enough differences from INET to require this.
	(bk_netinfo_info): Force bni to update and return pretty string.

	* lib/b_addrgroup.c (bk_addrgroup_destroy): Public interface for
	addrgroup destruction.
	(net_init_abort): Abort network initiation with correct clean up.
	(net_init_end): Finish network initiation with correct clean up.
	(tcp_connect_activity): Make sure that the event is removed and
	NULL'ed before when activity is detected.
	(tcp_connect_start): Don't recompute the socket type when you
	already know it.
	(do_net_init_af_inet_tcp_listen): Don't recompute the socket type
	whe you already know it.

	* lib/b_addrgroup.c (everywhere): Convert to new net_init
	strategy. Lots of smaller functions with specific tasks instead of
	monstrously large heterogenous ones.

	* lib/b_addrgroup.c (everywhere): replace net_close with
	net_init_abort(). 

2001-11-16  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_ioh.c (ioht_line_other): Minor break nit
	(ioht_vector_other): Subroutine needs to be in place where it can
	be executed by everyone who needs it.

2001-11-16  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_ioh.c (bk_ioh_init): all handler to be NULL with only a
	warning. This is but legal (see bk_ioh_relay).

	* lib/b_netinfo.c (bk_netinfo_update_hostent): pass bni *not*
	bni->bni_addrs (sigh).
	(bk_netinfo_destroy): Don't forget to destroy clc's

2001-11-15  James Tanis  <jtt@winwood.sysdetect.com>

	* libbk: Too many changes to document here. Basic support for
	asynchronous connect (working).

2001-11-13  James Tanis  <jtt@winwood.sysdetect.com>

	* include/libbk.h (struct bk_netinfo): Redo comments for doxygen.

	* test_getbyfoo.c: test case for doing queries with NULL copyout
	variables.

	* b_netaddr.c: Properly updae a bk_netaddr on the basis of a net
	address. 

	* b_getbyfoo.c: Fixes for allowing copyout structure to be NULL.

2001-11-15  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_ioh.c (CALLBACK) (bk_ioh_close): Don't close if we are in
	the middle of a user callback, as this will leave the callee
	hanging.  Defer the close instead.  Eliminate notifyclose--we will
	*always* notify.

	* lib/b_relay.c (bk_relay_iohhandler): He is throttled on read,
	not me, when I write out some data.

	* lib/b_ioh.c (ioh_queue): Queue full return code being dropped by
	all and sundry.

2001-11-15  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_fun.c (bk_fun_exit): More info about implicit exits

	* lib/b_ioh.c (ioh_dequeue_byte): Abstract shared functionality
	into function.

2001-11-14  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_signal.c (bk_signal): conditionalize SA_SIGINFO, and
	document the problems with the current API if SA_SIGINFO exists
	and is used.

2001-11-14  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_ioh.c (ioht_block_other): Line misordering causing
	blocking to return invalid status codes, invalid command switch
	variable (switching on flags instead).
	(ioh_getlastbuf): Must offset for both inuse (read) and used
	(write)
	
	* lib/b_error.c (bk_error_iprint): File handles is another legal
	output source.

2001-11-14  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_ioh.c (bk_ioh_close): Ah silly boy.  You must check for a
	flag only in places where it can be found, not in other random
	flag variables in different flag-spaces.  I suppose Alex can make
	a good argument here about enums.  Hmm.

	* include/libbk.h (bk_debug_printbuf): Typo

2001-11-13  Seth Robertson  <seth@startide.sysdetect.com>

	* src/proto.c (main): You must use bk_general_debug_config *in place of*
	bk_debug_setconfig, not in addition to.

	* lib/b_signal.c (bk_signal): Common interface to async signal handlers

	* lib/b_relay.c: IOH relay code

	* lib/b_ioh.c (ioht_raw_other): Remove data from queue after freeing it.
	IOH now working (for some value of working) in RAW mode
	
	* test/test_ioh.c (relayer): Bug which caused us to trash memory

	* lib/b_error.c (bk_error_idump): Change order--less recent comes first

2001-11-13  Alexander Dupuy  <dupuy@sysdetect.com>

	* test/test_ioh.c (proginit): inet_aton returns zero on error
	(address_resolved): cast sockaddr * argument

2001-11-13  Seth Robertson  <seth@yeah.baka.org>

	* test/test_ioh.c: Add test program
	* lib/b_ioh.c: Add stdio functions

2001-11-12  Seth Robertson  <seth@yeah.baka.org>

	* src/proto.c: Doxygenate

	* lib/b_ioh.c: IOH is now code-complete

2001-11-12  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_getbyfoo.c (copy_hostent): Fencepost error in copying host
	address list.
	(bk_gethostbyfoo): Do not do FQDN searches be default. Allow them
	based on flag.
	(bk_gethostbyfoo): Save addresses in the correct way.

2001-11-08  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_netinfo.c: New file dealing with various aspects of
	network information. All utility functions (perhaps should be
	broken out into two files).

	* lib/b_getbyfoo.c: Port to new BK_MALLOC(CALLOC) semantics.

	* lib/b_string.c (bk_strlen): Acts like strlen, but bounded.

2001-11-07  James Tanis  <jtt@winwood.sysdetect.com>

	* b_run.c: Add function to turn off run. If the run is over make
	sure that select(2) doesn't block.

	* Added bk_gethostbyfoo and support.

2001-11-07  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_general.c: Convert BK_MALLOC to new semantic
	* lib/b_run.c: Convert BK_MALLOC to new semantic
	(bk_run_once): Convert to BK_TV_CMP instead of using float comparison

	* lib/b_config.c: Convert BK_MALLOC to new semantic

2001-11-06  James Tanis  <jtt@winwood.sysdetect.com>

	* test/test_getbyfoo.c (progrun): test program for getbyfoo
	functions. 

	* lib/b_getbyfoo.c (bk_getprotobyfoo): Get protoent by
	anything (not yet mutex'ed).
	(bk_protoent_destroy): Destroy a protoent created by above.
	(bk_getprotobyfoo): Get a servent by anything.
	(bk_protoent_destroy): Destroy the servent created above.

	* lib/b_config.c (bk_config_init): All user to pass in preferences.
	(bk_config_print): print config file.
	(load_config_from_file): Support for included files.
	(check_for_double_include): Recursive function to eliminate double
	inclusion.

	* src/proto.c (main): make sure we call debug_setconfig when
	debugging is turned on.

2001-11-05  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_ioh.c: More functions filled out.

	* lib/b_stdfun.c: Document standard functions.

	* lib/*.c: Change to new CLC iterate interface, updating all CLC #defines
	
	* lib/b_error.c: Add mark and filtering handling to error queue to improve its capabilities.
	Document error handling.
	
2001-11-05  James Tanis  <jtt@winwood.sysdetect.com>

	* src/proto.c (main): Port to popt.

2001-11-02  James Tanis  <jtt@winwood.sysdetect.com>

	* lib/b_run.c (bk_run_destroy): don't destroy things twice, but
	destroy everything at least once.

2001-11-01  James Tanis  <jtt@localhost.localdomain>

	* lib/b_run.c (bk_run_once): Add on demand function calls.
	(bk_run_on_demand_add): Public functions to add and remove functions
	to and from on demand list.
	(bk_run_once): sort out whether idle task should be run.
	(bk_run_once): sort out exactly which timeout to use in select.

2001-11-01  James Tanis  <jtt@saint.sysdetect.com>

	* lib/b_run.c (bk_run_once): update poll functions to have list.
	(bk_run_once): Add idle task.
	(bk_run_poll_add): Public functions to add and remove functions
	to and from poll list.
	(bk_run_idle_add): Public functions to add  and remove functions
	to and run idle list.

2001-11-01  Seth Robertson  <seth@startide.sysdetect.com>

	* lib/b_run.c (bk_run_handsoff): Yes, we do need a method of getting rid of file associations

2001-09-21  James Tanis  <jtt@outpost.tanis.org>

	* lib/b_bits.c: libbk not libphadm.

2001-10-11  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_bits.c (bk_bits_create): allocate a byte for zero bits

2001-10-10  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_bits.c (bk_bits_save): save 0 bits as "0" [distinct from "00"]
	(bk_bits_restore): restore "0" as 0 bits [allocate a byte anyhow]

2001-09-30  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_run.c: Initial baka run environment

2001-09-29  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (BK_STRING_QUOTE_NULLOK): allow NULL char *
	(BK_NULLSTR): string placeholder for NULL

	* lib/b_bits.c (bk_bits_save): decrement size by 8 bits per char
	(bk_bits_restore): size (in bits) is 4*strlen(x)

	* lib/b_string.c (bk_string_tokenize_split): avoid segv for default ws
	(bk_string_quote): generate NULL for NULL, if ok

2001-09-25  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk_include.h: include winsock.h, process.h, instead
	of various unix-specific include files

	* include/libbk_oscompat.h: typedefs and #defines to work with mingw

	* lib/b_general.c (bk_general_init): no openlog() call on windows
	(bk_general_vsyslog): no syslog() calls on windows

	* test/test_stringconv.c: avoid name/type clashes with int32/uint32

2001-09-18  Alexander Dupuy  <dupuy@sysdetect.com>

	* lib/b_config.c (bk_config_init): failure of load_config_from_file
	is non-fatal, and does not cause destruction of bk_config struct

2001-09-17  Alexander Dupuy  <dupuy@sysdetect.com>

	* include/libbk.h (BK_GENERAL_FLAGS): avoid Linux gcc warnings
	about signed vs. unsigned

	* lib/b_general.c: avoid Linux gcc warnings about signed vs. unsigned

2001-09-11  Seth Robertson  <seth@yeah.baka.org>

	* include/libbk_oscompat.h: Move NULL/MAX/MIN issues to oscompat.

2001-09-11    <dupuy@cs.columbia.edu>

	* lib/b_debug.c (bk_debug_iprint): avoid Unix dependency here too

	also cleanup unneeded /**/ for string concatenation

2001-09-10  Alexander Dupuy  <dupuy@cs.columbia.edu>

	* lib/b_error.c (be_error_output): avoid infinite recursion, Unix
	dependency

2001-09-10  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_fun.c (bk_fun_exit): Previous change leaked memory.
	Now properly handling !B.

	* include/libbk.h: BK_RETURN no longer coredump on !B

2001-09-08  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_bits.c: Bit operations created

2001-09-04  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_cksum.c (b_in_cksum): Add in_cksum from Net4BSD

2001-09-03  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_string.c: Create 64 bit version of atou and atoi.
	(bk_string_atoflag/bk_string_flagtoa): Hide flags representation
	for ascii conversion.
	(bk_string_quote): Function to quote strings for output.

2001-08-31  Seth Robertson  <seth@yeah.baka.org>

	* src/proto.c: Full prototype "Hello World".  Will need more work
	(or a different version!) once additional functionality becomes
	ready.

	* lib/b_error.c (bk_error_idump): Get working, reverse order.
	(be_error_output): Enable time output.
	(bk_error_iprint): output errors during runtime only if hi priority

2001-08-30  Seth Robertson  <seth@yeah.baka.org>

	* test/test_stringconv.c: Test program now operational.  atoish
	functions tested.  Hash function tested.  String tokenization
	tested.  Debugging tested.  Config tested.

	* lib/b_config.c (config_manage): Make work
	(load_config_from_file): Fgets is the correct function...
	(bck_create): DLL must be unordered if no cmp funs

	* lib/b_stdfun.c: Create standard helper functions

	* include/libbk.h (BK_ENV_GWD): Fix definition

	* lib/b_general.c (bk_general_debug_config): Single function to
	configure debugging.

	* lib/b_fun.c (bk_fun_reset_debug): New function to reset debug
	levels of all entered functions.

2001-08-29  Seth Robertson  <seth@yeah.baka.org>

	* test/test_stringconv.c: Fill out string test program.

	* lib/b_string.c (bk_string_rip): Add rip to terminate strings on bad chars

2001-08-26  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_string.c (bk_string_printbuf): Fix binary output function.

	* include/libbk.h: BK_GENERAL_* macros to check for B allocation
	before dereference.

	* lib/b_string.c (bk_string_tokenize_split): Finished tokenization code.

	* lib/b_memx.c: Dynamic array extension code

2001-08-19  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_string.c: Filling out string functions

	* lib/b_error.c (be_error_output): Convert to using bk_general_syslog

	* lib/b_debug.c (bk_debug_iprint): Convert to using bk_general_syslog

	* lib/*.c: CLC #defines had _uniq screwed up
	
	* lib/b_funlist.c: Fill out funlist functions

	* lib/b_general.c: New funlist APIs.

2001-08-16  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_fun.c (bk_fun_destroy): Convert to DICT_NUKE_CONTENTS
	* lib/b_debug.c (bk_debug_destroy): Convert to DICT_NUKE_CONTENTS
	
	* lib/b_error.c: Write error functions

	* lib/b_debug.c: error functions will have incorrect function name
	listed.

	* lib/b_config.c (kv_key_hash): Switch to new strhash API.

	* lib/b_debug.c: Fill out debug function.

	* lib/b_string.c (bk_strhash): This is code trans-scribed
	*directly* from K&P, modula the NOMODULUS flag I just put in.

2001-07-15  James Tanis  <jtt@outpost.tanis.org>

	* lib/b_config.c (bck_create): Main maintence function.

2001-07-13  James Tanis  <jtt@outpost.tanis.org>

	* lib/b_config.c: More config stuff.
	(bc_config_delete_key): Even More config stuff

2001-07-09  James Tanis  <jtt@outpost.tanis.org>

	* lib/b_general.c (bk_general_destroy): redo config stuff for new
	interface.

	* lib/b_fun.c (funstack_error_reason): properly protect macro args.

	* lib/b_config.c: first codelets for config stuff.

2001-07-04  Seth Robertson  <seth@yeah.baka.org>

	* lib/b_general.c: Completed and compiling!
